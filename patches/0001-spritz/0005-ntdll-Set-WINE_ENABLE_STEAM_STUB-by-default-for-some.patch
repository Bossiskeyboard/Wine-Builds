From 11b71bbab15d0aa207235d20cd15a60c45ab545f Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Tue, 7 Oct 2025 13:06:25 +0200
Subject: [PATCH 5/9] ntdll: Set WINE_ENABLE_STEAM_STUB by default for some
 games

Fixes crashes at startup for games which check if they've been
launched from 'steam.exe' in their code.
---
 dlls/ntdll/unix/loader.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/dlls/ntdll/unix/loader.c b/dlls/ntdll/unix/loader.c
index 27308d22900..76c1a4958a7 100644
--- a/dlls/ntdll/unix/loader.c
+++ b/dlls/ntdll/unix/loader.c
@@ -2217,6 +2217,11 @@ static void hacks_init(void)
 {
     const char *sgi = getenv( "SteamGameId" );
     const char *env_str;
+
+    if (main_argc > 1 && (strstr(main_argv[1], "GenshinImpact.exe") || strstr(main_argv[1], "YuanShen.exe") 
+        || strstr(main_argv[1], "fpsunlock.exe") || strstr(main_argv[1], "ZenlessZoneZero.exe") ))
+        setenv( "WINE_ENABLE_STEAM_STUB", "1", 0 );
+
     if ((env_str = getenv("WINE_RAM_REPORTING_BIAS")))
     {
         ram_reporting_bias = atoll(env_str) * 1024 * 1024;
-- 
2.52.0

